<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Plotlines</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="css/relations.css" />
	<link rel="stylesheet" href="css/main.css" />

	<!-- Vendor -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript" src="js/vendor/d3/d3.v3.js"></script>
	<script type="text/javascript" src="js/vendor/narrative/narrative.js"></script>

	<script type="text/javascript" src="js/parse.js"></script>
	<script type="text/javascript" src="js/scrape.js"></script>
</head>
<body>
	<header>
		<h1>
			<span id="name">Plotlines</span>
			<input type="text" id="title" name="title" placeholder="Enter a book or movie title" />
		</h1>
	</header>
	<main>
		<p id="hover"></p>
		<div id="chart">
		</div>
		<div id="t">
		</div>
	</main>
	<script type="text/javascript">
		var title_el = document.getElementById('title');
		title_el.onkeyup = function engage(e) {
			title_el.className = '';
			if (e.keyCode !== 13)
				return;

			var title = title_el.value;
			try {
				var data = parse(
					relations(
						scrape_wikipedia(
							title
						)
					)
				);
				table(data);
				draw_chart('narrative', 'narrative', format(data), true, false);
			}
			catch(e) {
				title_el.className = 'error';
				var errmsg = e;
				if (e === "Synopsis not found") {
					errmsg = "No synopsis found for " + title;
					alert(errmsg);
				}
				throw errmsg;
			}
		}
	</script>
</body>
</html>
